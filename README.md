## Effect HOOK (副作用函数用这个Hook)

Effect Hook: 用于在函数组件中处理副作用(有副作用的操作都写到这个里面)

副作用:

1.ajax请求
2.计时器
3.其他异步操作
4.更改真实DOM对象
5.本地存储
6.其他会对外部产生影响的操作
(react只运行在三种情况添加副作用代码,比如生命周期componentDidMount中和componentDidUpdate这两个都是在render形成真实DOM之后调用还有一种是compoentWillUnMount)

函数:useEffect,该函数接受一个函数作为参数,接收的函数就是需要进行副作用操作的函数

**细节**
1.副作用函数的运行时间点:是在页面完成真实的UI渲染之后,因此他的操作是异步的,并且不会阻塞浏览器
    1.与类组件中componentDidMount和compoentDidUpdate的区别
    2.componentDidMount和componentDidUpdate,更改了真实DOM,但是用户还没有看到UI更新,同步的
    3.useEffect中的副作用函数,更改了真实DOM,并且用户已经看到UI更新,异步的.
2.每个函数中,可以多次使用useEffect,但不要放入判断或循环等代码块中
3.useEffect中的副作用函数,可以有返回值,返回值必是一个函数,该函数叫做清理函数
    1.该函数运行时间点,在每次运行副作用函数之前
    2.首次渲染组件不会运行
    3.组件被销毁时一定会运行
4.useEffect函数,可以传第二个参数
    1.第二个参数是一个数组
    2.数组中记录改副作用的依赖值
    3.当组件重新渲染后,只有依赖数据与上一次不一样时,才会执行副作用
    4.所以,当传递了依赖数据之后,如果数据没有发生变化
        1.副作用函数仅在第一次渲染后运行
        2.清理函数只有在页面销毁的时候运行
5.副作用函数中,如果使用了函数上下文中的变量

```js
场景一:
useEffect(async () => {
    const result = await fetchData(id)
    setData(result)
},[id])
```
这种写法错误
违反了Reacat设计原则
Effect要返回清理函数,这里用async的话默认会返回一个promise,并不是React推荐的清理函数,所以React会报错

难点业务
一个搜索框用户输入数据,发送请求,返回的搜索结果实时显示
1.排除防抖写法,产品时间反馈结果显示太慢
2.发现有个业务痛点:用户输入a,又输入b
ab的请求先展示,然后a的请求后面才到,结果会覆盖掉ab的正确结果

解决方法一:
设置全局开关
在then的时候判断开关是否开启,如果开启则渲染页面这样将不会出现a的结果把ab的结果覆盖掉
但是有个弊端a的请求还会发送这样还是会造成服务器资源的浪费
```js
useEffect(()=>{
    const isMount = true
    fetchData(id).then(result=>{
        isMount = false
        setData(result)
    })
    return ()=>{
        isMount = false
    }
},[id])
```

解决方法二:
用浏览器原生的api AbortController()
```js
useEffect(()=>{
    const controller = new AbortController(); //1.创建 AbortController实例
    try{
        fetch(`/api/data?id=${id}`,{
            signal:controller.sjgnal,//传递signal
        }).then(result=>{
            isMount = false
            setData(result)
        })
    }catch(error){
        if(error.name == 'AbortError'){
            //请求被终止是预期行为
        }else{
            // 处理其他错误
        }
    }
    return ()=>{
        controller.abort();
    }
})
// 这样处理完的话a的网络请求会被终止,不会造成服务器性能浪费
```























**注意事项**
朋友，小戒靠忍，大戒靠悟。多去接触接触佛法，了解色欲的本质真相。其实欲望来的时候就是你身体周围啖精气鬼在影响你，刺激你的下体，让你有想淫欲的心，并不是你自己本性想这样，你想想你每次破戒以后是不是没有那种想淫欲的感觉了，整个人也清醒了，也想做个好人了，这就是因为破戒以后他们吃饱了，不影响你了，你恢复了自性中的你。不管男女下体是很肮脏恶臭的地方，你想想为什么我们欲望来的时候会对这个东西感兴趣，就是你被周围的看不见的一些低贱的阴间灵体所影响，因为他们喜欢，所以迷惑你的念头让你喜欢，让你破戒去供他们吃饱。我们被鬼和兽给控制主宰了。我们把这些鬼的欢喜当成了自己的欢喜，把鬼的念头当成自己的念头，把鬼当作了自己。一个正常的人，怎么会对男女的下体感兴趣？怎么会对一块臭烘烘、肮脏的肉无比激动和兴奋呢？所以明白了本质，看清了真相就悟出了道理，下次再想破戒的时候就想想他们又想吃饭了，他们又在周围刺激你的下体，让你有性欲，让你破戒，所以你去破戒有什么意义呢？一次次破戒害了自己身体，害了自己的运气，最后一事无成。性欲强并且经常破戒的人身体周围这种鬼就越多，因为它们知道你这能经常提供精血食物，周围越多对你的影响就越大，就越想破戒，总想破戒。努力戒一段时间，这样低下的阴间灵体知道从你这获取不到食物精气，时间久了就不会缠着你了，慢慢就成功了。多念阿弥陀佛和观世音菩萨对戒色有很大帮助，功德不可思议。希望上述所讲可以帮助到你。如果它能帮助到你，也请你转发给别人，希望能帮助更多的人。





